"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const path = require("path");
const colors = require("colors");
const child_process = require("child_process");
if (process.argv[2] === undefined) {
    console.error(colors.red(`[BDSX-Plugins] Please provide the parameter for the target path`));
    process.exit(-1);
}
const targetPath = path.resolve(process.argv[2]);
if (fs.existsSync(targetPath)) {
    console.error(colors.red(`[BDSX-Plugins] '${targetPath}' already exists`));
    process.exit(0);
}
function mkdirRecursiveSync(dirpath) {
    try {
        fs.mkdirSync(dirpath);
        return;
    }
    catch (err) {
        if (err.code === 'EEXIST')
            return;
        if (['EACCES', 'EPERM', 'EISDIR'].indexOf(err.code) !== -1)
            throw err;
    }
    mkdirRecursiveSync(path.dirname(dirpath));
    fs.mkdirSync(dirpath);
}
mkdirRecursiveSync(targetPath);
const basename = path.basename(targetPath);
const targetdir = targetPath + path.sep;
// index.ts
{
    const clsname = camelize(basename);
    const exampleSource = `
import { bedrockServer } from "bdsx";

console.log('[plugin:${clsname}] allocated');

bedrockServer.open.on(()=>{
    console.log('[plugin:${clsname}] launching');
});

bedrockServer.close.on(()=>{
    console.log('[plugin:${clsname}] closed');
});

`;
    fs.writeFileSync(targetdir + 'index.ts', exampleSource, 'utf-8');
}
// package.json
{
    const bdsxPath = path.join(__dirname, '..');
    const examplejson = {
        "name": `@bdsx/${basename}`,
        "version": "1.0.0",
        "description": "",
        "main": "index.js",
        "keywords": [],
        "author": "",
        "license": "ISC",
        "bdsxPlugin": true,
        "devDependencies": {
            "bdsx": `file:${path.relative(targetPath, bdsxPath).replace(/\\/g, '/')}`
        }
    };
    fs.writeFileSync(targetdir + 'package.json', JSON.stringify(examplejson, null, 2), 'utf-8');
}
// tsconfig.json
{
    const tsconfig = JSON.parse(fs.readFileSync('./tsconfig.json', 'utf-8'));
    delete tsconfig.exclude;
    fs.writeFileSync(targetdir + 'tsconfig.json', JSON.stringify(tsconfig, null, 2), 'utf-8');
}
// .npmignore
{
    const npmignore = `
/.git
!*.d.ts
*.ts
`;
    fs.writeFileSync(targetdir + '.npmignore', npmignore, 'utf-8');
}
function camelize(context) {
    const reg = /[a-zA-Z]+/g;
    let out = '';
    for (;;) {
        const matched = reg.exec(context);
        if (matched === null)
            return out;
        const word = matched[0];
        out += word.charAt(0).toLocaleUpperCase() + word.substr(1);
    }
}
const currentdir = process.cwd();
process.chdir(targetdir);
child_process.execSync('npm i', { stdio: 'inherit' });
process.chdir(currentdir);
child_process.execSync(`npm i "${path.relative(currentdir, targetdir).replace(/\\/g, '/')}"`, { stdio: 'inherit' });
console.log(`[BDSX-Plugins] Generated at ${targetPath}`);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmV3LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibmV3LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEseUJBQTBCO0FBQzFCLDZCQUE4QjtBQUM5QixpQ0FBa0M7QUFDbEMsK0NBQWdEO0FBRWhELElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxTQUFTLEVBQUU7SUFDL0IsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGlFQUFpRSxDQUFDLENBQUMsQ0FBQztJQUM3RixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Q0FDcEI7QUFDRCxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNqRCxJQUFJLEVBQUUsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLEVBQUU7SUFDM0IsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLG1CQUFtQixVQUFVLGtCQUFrQixDQUFDLENBQUMsQ0FBQztJQUMzRSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0NBQ25CO0FBRUQsU0FBUyxrQkFBa0IsQ0FBQyxPQUFjO0lBQ3RDLElBQUk7UUFDQSxFQUFFLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3RCLE9BQU87S0FDVjtJQUFDLE9BQU8sR0FBRyxFQUFFO1FBQ1YsSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLFFBQVE7WUFBRSxPQUFPO1FBQ2xDLElBQUksQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQUUsTUFBTSxHQUFHLENBQUM7S0FDekU7SUFDRCxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxD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