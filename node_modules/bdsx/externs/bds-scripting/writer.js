"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FileWriter = void 0;
const fs = require("fs");
class FileWriter {
    constructor(path) {
        this.ws = fs.createWriteStream(path, 'utf-8');
        this.errprom = new Promise((resolve, reject) => {
            this.ws.on('error', reject);
        });
    }
    write(data) {
        return Promise.race([
            new Promise(resolve => {
                if (!this.ws.write(data)) {
                    this.ws.once('drain', resolve);
                }
                else {
                    resolve();
                }
            }),
            this.errprom
        ]);
    }
    end() {
        return Promise.race([
            new Promise((resolve) => {
                this.ws.end(resolve);
            }),
            this.errprom
        ]);
    }
}
exports.FileWriter = FileWriter;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid3JpdGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsid3JpdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLHlCQUEwQjtBQUUxQixNQUFhLFVBQVU7SUFHbkIsWUFBWSxJQUFXO1FBQ25CLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLGlCQUFpQixDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBQyxFQUFFO1lBQzFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCxLQUFLLENBQUMsSUFBVztRQUNiLE9BQU8sT0FBTyxDQUFDLElBQUksQ0FBQztZQUNoQixJQUFJLE9BQU8sQ0FBTyxPQUFPLENBQUEsRUFBRTtnQkFDdkIsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUN0QixJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7aUJBQ2xDO3FCQUFNO29CQUNILE9BQU8sRUFBRSxDQUFDO2lCQUNiO1lBQ0wsQ0FBQyxDQUFDO1lBQUUsSUFBSSxDQUFDLE9BQU87U0FBQyxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVELEdBQUc7UUFDQyxPQUFPLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFDaEIsSUFBSSxPQUFPLENBQU8sQ0FBQyxPQUFPLEVBQUMsRUFBRTtnQkFDekIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDekIsQ0FBQyxDQUFDO1lBQUUsSUFBSSxDQUFDLE9BQU87U0FBQyxDQUFDLENBQUM7SUFDM0IsQ0FBQztDQUNKO0FBM0JELGdDQTJCQyJ9