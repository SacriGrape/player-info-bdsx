"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createPacketRaw = exports.createPacket = exports.PacketSharedPtr = exports.Packet = exports.ExtendedStreamReadResult = exports.StreamReadResult = exports.PacketReadResult = void 0;
const tslib_1 = require("tslib");
const common_1 = require("bdsx/common");
const makefunc_1 = require("bdsx/makefunc");
const nativeclass_1 = require("bdsx/nativeclass");
const sharedpointer_1 = require("bdsx/sharedpointer");
const nativetype_1 = require("../nativetype");
const proc_1 = require("./proc");
// export interface PacketType<T> extends StructureType<T>
// {
//     readonly ID:number;
// }
exports.PacketReadResult = nativetype_1.uint32_t.extends({
    PacketReadNoError: 0,
    PacketReadError: 1,
});
exports.StreamReadResult = nativetype_1.int32_t.extends({
    Disconnect: 0,
    Pass: 1,
    Warning: 2,
    Ignore: 0x7f,
});
let ExtendedStreamReadResult = class ExtendedStreamReadResult extends nativeclass_1.NativeClass {
};
tslib_1.__decorate([
    nativeclass_1.nativeField(exports.StreamReadResult)
], ExtendedStreamReadResult.prototype, "streamReadResult", void 0);
tslib_1.__decorate([
    nativeclass_1.nativeField(nativetype_1.int32_t)
], ExtendedStreamReadResult.prototype, "dummy", void 0);
ExtendedStreamReadResult = tslib_1.__decorate([
    nativeclass_1.nativeClass()
], ExtendedStreamReadResult);
exports.ExtendedStreamReadResult = ExtendedStreamReadResult;
const sharedptr_of_packet = Symbol('sharedptr');
let Packet = class Packet extends nativeclass_1.MantleClass {
    /**
     * @deprecated use packet.destruct();
     */
    destructor() {
        common_1.abstract();
    }
    getId() {
        common_1.abstract();
    }
    getName(name) {
        common_1.abstract();
    }
    write(stream) {
        common_1.abstract();
    }
    read(stream) {
        common_1.abstract();
    }
    readExtended(read, stream) {
        common_1.abstract();
    }
    /**
     * same with target.send
     */
    sendTo(target, unknownarg) {
        common_1.abstract();
    }
    dispose() {
        this[sharedptr_of_packet].dispose();
        this[sharedptr_of_packet] = null;
    }
    static create() {
        const id = this.ID;
        if (id === undefined)
            throw Error('Packet class is abstract, please use named class instead (ex. LoginPacket)');
        const cls = sharedpointer_1.SharedPtr.make(this);
        const sharedptr = new cls(true);
        exports.createPacketRaw(sharedptr, id);
        const packet = sharedptr.p;
        if (packet === null)
            throw Error(`${this.name} is not created`);
        packet[sharedptr_of_packet] = sharedptr;
        return packet;
    }
};
Packet = tslib_1.__decorate([
    nativeclass_1.nativeClass(0x30)
], Packet);
exports.Packet = Packet;
exports.PacketSharedPtr = sharedpointer_1.SharedPtr.make(Packet);
/**
 * @deprecated use *Packet.create() instead
 */
function createPacket(packetId) {
    const p = new exports.PacketSharedPtr(true);
    exports.createPacketRaw(p, packetId);
    return new sharedpointer_1.SharedPointer(p);
}
exports.createPacket = createPacket;
exports.createPacketRaw = proc_1.procHacker.js("MinecraftPackets::createPacket", exports.PacketSharedPtr, null, exports.PacketSharedPtr, makefunc_1.RawTypeId.Int32);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFja2V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicGFja2V0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSx3Q0FBdUM7QUFDdkMsNENBQTBDO0FBQzFDLGtEQUFzRjtBQUV0RixzREFBOEQ7QUFDOUQsOENBQWtEO0FBR2xELGlDQUFvQztBQUdwQywwREFBMEQ7QUFDMUQsSUFBSTtBQUNKLDBCQUEwQjtBQUMxQixJQUFJO0FBRVMsUUFBQSxnQkFBZ0IsR0FBRyxxQkFBUSxDQUFDLE9BQU8sQ0FBQztJQUM3QyxpQkFBaUIsRUFBRSxDQUFDO0lBQ3BCLGVBQWUsRUFBRSxDQUFDO0NBQ3JCLENBQUMsQ0FBQztBQUlVLFFBQUEsZ0JBQWdCLEdBQUcsb0JBQU8sQ0FBQyxPQUFPLENBQUM7SUFDNUMsVUFBVSxFQUFFLENBQUM7SUFDYixJQUFJLEVBQUUsQ0FBQztJQUNQLE9BQU8sRUFBRSxDQUFDO0lBQ1YsTUFBTSxFQUFFLElBQUk7Q0FDZixDQUFDLENBQUM7QUFJSCxJQUFhLHdCQUF3QixHQUFyQyxNQUFhLHdCQUF5QixTQUFRLHlCQUFXO0NBTXhELENBQUE7QUFKQTtJQURJLHlCQUFXLENBQUMsd0JBQWdCLENBQUM7a0VBQ0M7QUFFbEM7SUFESSx5QkFBVyxDQUFDLG9CQUFPLENBQUM7dURBQ1Y7QUFKRix3QkFBd0I7SUFEcEMseUJBQVcsRUFBRTtHQUNELHdCQUF3QixDQU1wQztBQU5ZLDREQUF3QjtBQVFyQyxNQUFNLG1CQUFtQixHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUdoRCxJQUFhLE1BQU0sR0FBbkIsTUFBYSxNQUFPLFNBQVEseUJBQVc7SUFJbkM7O09BRUc7SUFDSCxVQUFVO1FBQ04saUJBQVEsRUFBRSxDQUFDO0lBQ2YsQ0FBQztJQUNELEtBQUs7UUFDRCxpQkFBUSxFQUFFLENBQUM7SUFDZixDQUFDO0lBQ0QsT0FBTyxDQUFDLElBQXFCO1FBQ3pCLGlCQUFRLEVBQUUsQ0FBQztJQUNmLENBQUM7SUFDRCxLQUFLLENBQUMsTUFBbUI7UUFDckIsaUJBQVEsRUFBRSxDQUFDO0lBQ2YsQ0FBQztJQUNELElBQUksQ0FBQyxNQUFtQjtRQUNwQixpQkFBUSxFQUFFLENBQUM7SUFDZixDQUFDO0lBQ0QsWUFBWSxDQUFDLElBQTZCLEVBQUUsTUFBbUI7UUFDM0QsaUJBQVEsRUFBRSxDQUFDO0lBQ2YsQ0FBQztJQUVEOztPQUVHO0lBQ0gsTUFBTSxDQUFDLE1BQXdCLEVBQUUsVUFBa0I7UUFDL0MsaUJBQVEsRUFBRSxDQUFDO0lBQ2YsQ0FBQztJQUNELE9BQU87UUFDSCxJQUFJLENBQUMsbUJBQW1CLENBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNyQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsR0FBRyxJQUFJLENBQUM7SUFDckMsQ0FBQztJQUVELE1BQU0sQ0FBQyxNQUFNO1FBQ1QsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUNuQixJQUFJLEVBQUUsS0FBSyxTQUFTO1lBQUUsTUFBTSxLQUFLLENBQUMsNEVBQTRFLENBQUMsQ0FBQztRQUNoSCxNQUFNLEdBQUcsR0FBRyx5QkFBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNqQyxNQUFNLFNBQVMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQyx1QkFBZSxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUUvQixNQUFNLE1BQU0sR0FBRyxTQUFTLENBQUMsQ0FBTSxDQUFDO1FBQ2hDLElBQUksTUFBTSxLQUFLLElBQUk7WUFBRSxNQUFNLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLGlCQUFpQixDQUFDLENBQUM7UUFDaEUsTUFBTSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsU0FBUyxDQUFDO1FBQ3hDLE9BQU8sTUFBTSxDQUFDO0lBQ2xCLENBQUM7Q0FDSixDQUFBO0FBakRZLE1BQU07SUFEbEIseUJBQVcsQ0FBQyxJQUFJLENBQUM7R0FDTCxNQUFNLENBaURsQjtBQWpEWSx3QkFBTTtBQW9ETixRQUFBLGVBQWUsR0FBRyx5QkFBUyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUd0RDs7R0FFRztBQUNILFNBQWdCLFlBQVksQ0FBQyxRQUEyQjtJQUNwRCxNQUFNLENBQUMsR0FBRyxJQUFJLHVCQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEMsdUJBQWUsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDN0IsT0FBTyxJQUFJLDZCQUFhLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDaEMsQ0FBQztBQUpELG9DQUlDO0FBRVksUUFBQSxlQUFlLEdBQUcsaUJBQVUsQ0FBQyxFQUFFLENBQUMsZ0NBQWdDLEVBQUUsdUJBQWUsRUFBRSxJQUFJLEVBQUUsdUJBQWUsRUFBRSxvQkFBUyxDQUFDLEtBQUssQ0FBQyxDQUFDIn0=